# Эмулятор давления на ESP32-C3 с BLE

Этот проект превращает плату на базе ESP32-C3 в BLE-периферийное устройство, которое эмулирует датчик давления. Управлять целевым значением давления можно как с помощью физических кнопок на устройстве, так и по Bluetooth Low Energy. Текущее значение давления плавно изменяется и отправляется подключенному клиенту через BLE-уведомления.

## Основные возможности

- **BLE Сервис:** Создает кастомный BLE-сервис с одной характеристикой для управления и чтения данных.
- **Эмуляция давления:** Значение давления плавно стремится к целевому значению с использованием фильтра нижних частот, обеспечивая реалистичное изменение.
- **Двойное управление:**
  - **Физические кнопки:** Две кнопки для установки положительного (`+50.0`) и отрицательного (`-50.0`) целевого давления.
  - **BLE-команды:** Отправка команд на запись в характеристику для установки целевого давления.
- **Обратная связь:**
  - **BLE-уведомления:** Текущее значение давления (тип `float`, 4 байта) отправляется подписчикам каждые 50 мс.
  - **Светодиодная индикация:** Светодиоды показывают статус BLE-соединения и текущее направление давления (положительное/отрицательное).

## Аппаратные компоненты

- Плата разработки на ESP32-C3 (например, ESP32-C3 Super Mini).
- 2 тактовые кнопки.
- 1 RGB-светодиод (или 3 отдельных светодиода: красный, зеленый, синий).
- Соединительные провода.

## Схема подключения (пины)

| Компонент                                | Пин GPIO |
| :--------------------------------------- | :------- |
| Кнопка 1 (положит. давление)             | `GPIO 0` |
| Кнопка 2 (отрицат. давление)             | `GPIO 1` |
| Синий светодиод (индикатор подключения)  | `GPIO 2` |
| Зеленый светодиод (положит. давление)    | `GPIO 3` |
| Красный светодиод (отрицат. давление)    | `GPIO 4` |
| Встроенный светодиод (индикатор рекламы) | `GPIO 8` |

_Примечание: Кнопки должны быть подключены между пином GPIO и землей (GND). В коде используется внутренний подтягивающий резистор (`INPUT_PULLUP`)._

## Программное обеспечение и библиотеки

- **Среда разработки:** PlatformIO или Arduino IDE.
- **Библиотека:** `NimBLE-Arduino` (устанавливается автоматически через PlatformIO согласно `platformio.ini`).

## Как использовать

### 1. Сборка и прошивка

1.  Откройте проект в вашей любимой среде (например, VS Code с PlatformIO).
2.  Скомпилируйте и загрузите прошивку на вашу плату ESP32-C3.

### 2. Взаимодействие по BLE

1.  Используйте любое приложение для сканирования BLE-устройств (например, **nRF Connect for Mobile**, **LightBlue**).
2.  Найдите и подключитесь к устройству с именем `C1-Emulator`.
3.  **UUID Сервиса:** `12345678-1234-1234-1234-123456789abc`
4.  **UUID Характеристики:** `abcdefab-1234-5678-9abc-abcdefabcdef`

### 3. Управление устройством

- **Получение данных:**

  - В приложении найдите указанную характеристику и подпишитесь на **уведомления (Notifications)**.
  - Вы начнете получать 4-байтовые значения (little-endian float) текущего давления каждые 50 мс.

- **Отправка команд:**
  - В эту же характеристику отправьте байт в режиме **записи (Write/Write without response)**:
    - `0x01`: Установить целевое давление `+40.0`. Загорится зеленый светодиод.
    - `0x02`: Установить целевое давление `-40.0`. Загорится красный светодиод.
    - `0x00` или `0x03`: Установить целевое давление `0.0`. Красный и зеленый светодиоды погаснут.

## Логика работы светодиодов

- **Встроенный светодиод (GPIO 8):** Мигает, когда устройство находится в режиме рекламы (ожидает подключения). Гаснет после подключения клиента.
- **Синий светодиод (GPIO 2):** Загорается при успешном подключении BLE-клиента.
- **Зеленый светодиод (GPIO 3):** Загорается, когда по BLE получена команда на положительное давление.
- **Красный светодиод (GPIO 4):** Загорается, когда по BLE получена команда на отрицательное давление.
